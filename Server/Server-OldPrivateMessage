--[[
	Author: Sceleratis/Davey_Bones
	Description: This plugin adds a new command (:oldpm) which basically restores the old private message command.

	Place ModuleScript in Adonis_Loader > Config > Plugins and name it "Server-OldPM"
--]]

return function()
  local Admin = server.Admin;
  local Settings = server.Settings;
  local Commands = server.Commands;
  local Remote = server.Remote;
  local Logs = server.Logs;

  Remote.Commands.PrivateMessage = function(p,args)
    --	'Reply from '..localplayer.Name,player,localplayer,ReplyBox.Text
    local title = args[1]
    local target = args[2]
    local from = args[3]
    local message = args[4]
    Remote.MakeGui(target,"PrivateMessage",{
      Title = "Reply from ".. p.Name;--title;
      Player = p;
      Message = service.Filter(message, p, target);
    })

    Logs.AddLog(Logs.Script,{
      Text = p.Name.." replied to "..tostring(target),
      Desc = message,
      Player = p;
    })
  end;

  Commands.OldPrivateMessage = {
    Prefix = Settings.Prefix;
    Commands = {"oldpm";"oldprivatemessage";};
    Args = {"player";"message";};
    Filter = true;
    Description = "Send a private message to a player";
    AdminLevel = "Moderators";
    Function = function(plr, args)
      assert(args[1] and args[2], "Argument missing")
      if Admin.CheckAdmin(plr) then
        for _, v in ipairs(service.GetPlayers(plr, args[1])) do
          Remote.MakeGui(v, "PrivateMessage", {
            Title = "Message from "..plr.Name;
            Player = plr;
            Message = service.Filter(args[2], plr, v);
          })
        end
      end
    end
  };
end
